# FastAPI å‹åŠ›æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ
- **æµ‹è¯•æ—¶é—´**: 2026-02-17
- **æµ‹è¯•åˆ†æ”¯**: stress-test
- **æœåŠ¡å™¨**: Python FastAPI + Uvicorn
- **æµ‹è¯•å·¥å…·**: è‡ªå®šä¹‰å‹åŠ›æµ‹è¯•è„šæœ¬

## æµ‹è¯•é…ç½®
- **æ–°é—»ç”Ÿæˆé€Ÿç‡**: 1000æ¡/ç§’
- **æµ‹è¯•æ—¶é•¿**: 30ç§’
- **WebSocketå®¢æˆ·ç«¯**: 3ä¸ª
- **APIå®¢æˆ·ç«¯**: 2ä¸ª (10è¯·æ±‚/ç§’)
- **ç¼“å†²åŒºå¤§å°**: 1000æ¡

## æµ‹è¯•ç»“æœ

### ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡
- **æ€»æ–°é—»ç”Ÿæˆ**: 20,000æ¡
- **å®é™…ç”Ÿæˆé€Ÿç‡**: ~1000æ¡/ç§’
- **æµ‹è¯•æ€»æ—¶é•¿**: 20.74ç§’

### ğŸŒŒ WebSocketæ€§èƒ½
- **æ¶ˆæ¯æ¥æ”¶**: 663æ¡
- **WebSocketé”™è¯¯**: 0
- **ååé‡**: 31.97æ¶ˆæ¯/ç§’
- **è¿æ¥ç¨³å®šæ€§**: âœ… æ— é”™è¯¯

### ğŸŒ APIæ€§èƒ½
- **APIè°ƒç”¨æˆåŠŸ**: 386æ¬¡
- **APIé”™è¯¯**: 0
- **å¹³å‡å“åº”æ—¶é—´**: 0.003ç§’
- **æœ€å¤§å“åº”æ—¶é—´**: 0.012ç§’
- **æœ€å°å“åº”æ—¶é—´**: 0.002ç§’
- **APIååé‡**: 18.61è¯·æ±‚/ç§’

## ğŸ” æ€§èƒ½åˆ†æ

### âœ… ä¼˜åŠ¿
1. **APIå“åº”æ—¶é—´ä¼˜ç§€**: å¹³å‡3mså“åº”æ—¶é—´éå¸¸å¿«
2. **æ— é”™è¯¯ç‡**: WebSocketå’ŒAPIéƒ½æ— é”™è¯¯
3. **é«˜æ–°é—»ç”Ÿæˆèƒ½åŠ›**: èƒ½å¤Ÿå¤„ç†1000æ¡/ç§’çš„æ–°é—»ç”Ÿæˆ
4. **è¿æ¥ç¨³å®š**: æ‰€æœ‰WebSocketè¿æ¥ä¿æŒç¨³å®š

### âš ï¸ ç“¶é¢ˆåˆ†æ

#### 1. WebSocketå¹¿æ’­ç“¶é¢ˆ (ä¸»è¦ç“¶é¢ˆ)
**é—®é¢˜**: WebSocketååé‡ä»…31.97æ¶ˆæ¯/ç§’ï¼Œè¿œä½äºæ–°é—»ç”Ÿæˆé€Ÿç‡

**åŸå› åˆ†æ**:
- æ¯100æ¡æ–°é—»æ‰å¹¿æ’­ä¸€æ¬¡ (ä»£ç ä¸­è®¾ç½®äº† `if total_generated % 100 == 0`)
- WebSocketåŒæ­¥å‘é€å¯èƒ½å­˜åœ¨é˜»å¡
- å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶çš„å¹¿æ’­å¼€é”€

**å½±å“**: å®¢æˆ·ç«¯æ— æ³•å®æ—¶æ¥æ”¶æ‰€æœ‰æ–°é—»æ›´æ–°

#### 2. æ§åˆ¶å°æ‰“å°ç“¶é¢ˆ
**é—®é¢˜**: å¤§é‡çš„æ§åˆ¶å°è¾“å‡ºå¯èƒ½å½±å“æ€§èƒ½

**åŸå› åˆ†æ**:
- æ¯1000æ¡æ–°é—»æ‰“å°ä¸€æ¬¡è¿›åº¦
- æ¯æ¬¡APIè°ƒç”¨éƒ½æœ‰æ—¥å¿—è¾“å‡º
- WebSocketè¿æ¥/æ–­å¼€æ—¥å¿—

#### 3. å†…å­˜ä½¿ç”¨
**é—®é¢˜**: 20,000æ¡æ–°é—»çš„å¤„ç†å¯èƒ½æ¶ˆè€—å¤§é‡å†…å­˜

**åŸå› åˆ†æ**:
- æ–°é—»ç¼“å†²åŒºè®¾ç½®ä¸º1000æ¡
- ç»Ÿè®¡ä¿¡æ¯ç´¯ç§¯å­˜å‚¨
- å¤„ç†æ—¶é—´å†å²è®°å½•

## ğŸš€ ä¼˜åŒ–å»ºè®®

### 1. WebSocketä¼˜åŒ–
```python
# å½“å‰ä»£ç  (æ¯100æ¡å¹¿æ’­ä¸€æ¬¡)
if total_generated % 100 == 0:
    await broadcast_news(processed_news)
    await broadcast_statistics()

# å»ºè®®ä¼˜åŒ– (æ‰¹é‡å¹¿æ’­)
async def batch_broadcast(news_batch, stats_interval=100):
    if len(news_batch) >= 10:  # æ¯10æ¡æ‰¹é‡å‘é€
        await broadcast_news_batch(news_batch)
        news_batch.clear()
    
    if total_generated % stats_interval == 0:
        await broadcast_statistics()
```

### 2. å¼‚æ­¥æ—¥å¿—ä¼˜åŒ–
```python
# ä½¿ç”¨å¼‚æ­¥æ—¥å¿—è®°å½•
import logging
logging.basicConfig(level=logging.WARNING)  # å‡å°‘æ—¥å¿—è¾“å‡º

# æˆ–ä½¿ç”¨ä¸“é—¨çš„å¼‚æ­¥æ—¥å¿—åº“
import aiologger
logger = await aiologger.Logger.with_default_handlers()
```

### 3. å†…å­˜ä¼˜åŒ–
```python
# é™åˆ¶ç»Ÿè®¡ä¿¡æ¯å­˜å‚¨
class NewsProcessor:
    def __init__(self):
        self.processing_times = deque(maxlen=100)  # åªä¿ç•™æœ€è¿‘100æ¬¡
        self.categories_count = {}  # è€ƒè™‘å®šæœŸæ¸…ç†ä¸æ´»è·ƒåˆ†ç±»
```

### 4. è¿æ¥æ± ä¼˜åŒ–
```python
# ä½¿ç”¨è¿æ¥æ± ç®¡ç†WebSocketè¿æ¥
class ConnectionManager:
    def __init__(self):
        self.active_connections: List[WebSocket] = []
        self.connection_lock = asyncio.Lock()
    
    async def broadcast(self, message: str):
        async with self.connection_lock:
            # å¹¶å‘å¹¿æ’­è€Œéä¸²è¡Œ
            tasks = [conn.send_text(message) for conn in self.active_connections]
            await asyncio.gather(*tasks, return_exceptions=True)
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| æ–°é—»ç”Ÿæˆé€Ÿç‡ | 1000æ¡/ç§’ | 1000æ¡/ç§’ | âœ… è¾¾æ ‡ |
| WebSocketååé‡ | 32æ¶ˆæ¯/ç§’ | 500æ¶ˆæ¯/ç§’ | âŒ éœ€ä¼˜åŒ– |
| APIå“åº”æ—¶é—´ | 3ms | <10ms | âœ… ä¼˜ç§€ |
| é”™è¯¯ç‡ | 0% | <1% | âœ… ä¼˜ç§€ |
| å†…å­˜ä½¿ç”¨ | æœªçŸ¥ | <500MB | â“ éœ€ç›‘æ§ |

## ğŸ§ª è¿›ä¸€æ­¥æµ‹è¯•å»ºè®®

1. **å¢åŠ WebSocketå®¢æˆ·ç«¯æ•°é‡**: æµ‹è¯•10-50ä¸ªå¹¶å‘è¿æ¥
2. **æé«˜æ–°é—»ç”Ÿæˆé€Ÿç‡**: æµ‹è¯•2000-5000æ¡/ç§’
3. **é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•**: è¿è¡Œ1å°æ—¶ä»¥ä¸Š
4. **å†…å­˜æ³„æ¼æ£€æµ‹**: ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„å†…å­˜ä½¿ç”¨
5. **ç½‘ç»œå»¶è¿Ÿæµ‹è¯•**: æ¨¡æ‹Ÿé«˜å»¶è¿Ÿç½‘ç»œç¯å¢ƒ

## ğŸ“ ç»“è®º

FastAPIåœ¨é«˜é¢‘æ•°æ®å¤„ç†æ–¹é¢è¡¨ç°ä¼˜ç§€ï¼Œèƒ½å¤Ÿå¤„ç†1000æ¡/ç§’çš„æ–°é—»ç”Ÿæˆã€‚APIå“åº”æ—¶é—´éå¸¸å¿«ï¼Œæ— é”™è¯¯ç‡ã€‚ä¸»è¦ç“¶é¢ˆåœ¨äºWebSocketå¹¿æ’­æœºåˆ¶ï¼Œéœ€è¦ä¼˜åŒ–æ‰¹é‡å‘é€å’Œå¹¶å‘å¤„ç†ã€‚

**æ€»ä½“è¯„åˆ†**: B+ (APIæ€§èƒ½A+, WebSocketæ€§èƒ½C)

**ä¼˜å…ˆçº§**:
1. ğŸ”¥ é«˜ä¼˜å…ˆçº§: ä¼˜åŒ–WebSocketå¹¿æ’­æœºåˆ¶
2. ğŸ”¶ ä¸­ä¼˜å…ˆçº§: å‡å°‘æ§åˆ¶å°æ—¥å¿—è¾“å‡º
3. ğŸ”µ ä½ä¼˜å…ˆçº§: å†…å­˜ä½¿ç”¨ä¼˜åŒ–
